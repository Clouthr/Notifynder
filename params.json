{"name":"Notifynder","tagline":"Easy Internal Notification management for laravel 4.1","body":"Notifynder\r\n==========\r\n\r\n[![Build Status](https://travis-ci.org/fenos/Notifynder.svg?branch=master)](https://travis-ci.org/fenos/Notifynder)\r\n[![ProjectStatus](http://stillmaintained.com/fenos/Notifynder.png)](http://stillmaintained.com/fenos/Notifynder)\r\n[![License](https://poser.pugx.org/fenos/Notifynder/license.png)](https://packagist.org/packages/fenos/Notifynder)\r\n[![Latest Stable Version](https://poser.pugx.org/fenos/notifynder/v/stable.png)](https://packagist.org/packages/fenos/notifynder)\r\n\r\nNotifynder is a package that implement on your application a management system of internal notifications. Similar to facebook notifications. You cand send, make read, and more stay tuned on the following documentation. \r\nThis package has been released for Laravel 4 Framework.\r\n\r\n- - -\r\n####What's new####\r\n\r\n#####Release 1.4.0#####\r\n* [Advanced Categories](#advanced-categories)\r\n\r\n#####Release 1.4.5#####\r\n* [Notifications Handler](#notifications-handler)\r\n\r\n- - -\r\n\r\n\r\n\r\n* [Installation](#installation)\r\n* [Documentation](#documentation)\r\n* [Notification Categories](#notification-categories)\r\n    * [Add](#add-categories)\r\n    * [Update](#update-categories)\r\n    * [Delete](#delete-categories)\r\n    * [Advanced Categories](#advanced-categories)\r\n* [Send Notification/s](#send-notification-s)\r\n    * [Send single notification](#send-single-notification)\r\n    * [Send multiple notifications](#send-multiple-notifications)\r\n* [Read Notification/s](#read-notifications)\r\n    * [Read one](#read-one)\r\n    * [Read All](#read-all)\r\n    * [Read Limit](#read-limit)\r\n* [Retrive Notifications](#retrive-notifications)\r\n    * [Get not read](#get-not-read)\r\n    * [Get All](#get-all)\r\n* [Delete Notification/s](#delete-notifications)\r\n    * [Delete single](#delete-single)\r\n    * [Delete All](#delete-all)\r\n    * [Delete Limit](#delete-limit)\r\n* [Method Category()](#method-category)\r\n* [Translations](#translations)\r\n* [Notifications Handler](#notifications-handler)\r\n* [Extends Model Class](#extend-the-model-class)\r\n\r\n## Installation ##\r\n\r\n### Step 1 ###\r\n\r\nAdd it on your composer.json\r\n\r\n~~~\r\n\"fenos/notifynder\": \"1.4.*\"\r\n~~~\r\n\r\nand run **composer update**\r\n\r\n\r\n### Step 2 ###\r\n\r\nAdd the following string to **app/config/app.php**\r\n\r\n**Providers array:**\r\n\r\n~~~\r\n'Fenos\\Notifynder\\NotifynderServiceProvider'\r\n~~~\r\n\r\n**Aliases array:**\r\n\r\n~~~\r\n'Notifynder'\t=> 'Fenos\\Notifynder\\Facades\\Notifynder'\r\n~~~\r\n\r\n### Step 3 ###\r\n\r\n#### Migration ####\r\n\r\nMake sure that your settings on **app/config/database.php** are correct, then make the migration typing:\r\n\r\n~~~\r\nphp artisan migrate --package=\"fenos/notifynder\"\r\n~~~\r\n\r\n### Step 4 ###\r\n\r\n#### Connecting to the user Model ####\r\n\r\nNotifynder use a user model to get informations from who sent the notification and who receive the notification, so if you have a different name of user model, publish the configurations files and fill the path of your model.\r\n\r\n~~~\r\nphp artisan config:publish fenos/notifynder\r\n~~~\r\n\r\nThat's it! we have done with the installation!\r\n\r\n## Documentation ##\r\n\r\n### Notification Categories ###\r\n\r\nThe notification categories are just the body of the your notification. As first release we have only 2 fields availables:\r\n\r\n- name\r\n- text\r\n\r\n### Add categories ###\r\n\r\nLet's say an example, We want to add a **Body Text** notification that says: **News recently updated from the city of London**\r\n\r\nWell for create that it's easy:\r\n\r\n~~~\r\nNotifynder::addCategory('londonNews','News recently updated from the city of London');\r\n~~~\r\n\r\nLike so we have added a category in our database.\r\nAs First parameter we will add the key of the notification, as second paramenter we add the body.\r\n\r\n### Update categories ###\r\n\r\n~~~\r\n$new_informations = array( 'body' => 'New body of the category' );\r\n\r\nNotifynder::updateCategory($new_informations,1);\r\n~~~\r\n\r\nAs first parameter you pass an array with keys of the fields that you want update and the value with the new content.\r\nAs second paramenter you pass the id of the current category to update.\r\n\r\n**Second option**\r\n\r\nHow second option if you don't want hardcode the id of the category you can update your row simply like so:\r\n\r\n~~~\r\ntry\r\n{\r\n    $new_informations = array( 'body' => 'New body of the category' );\r\n    \r\n    Notifynder::category('londonNews')->updateCategory($new_informations);\r\n}\r\ncatch(Fenos\\Notifynder\\Exceptions\\NotificationCategoryNotFoundException $e)\r\n{\r\n\r\n    // category not found\r\n\r\n}\r\n~~~\r\n\r\nOn the category method you'll pass the name of the category that you want update and on the update method just the informations.\r\n\r\n### Delete categories ###\r\n\r\nFor the delete a category just:\r\n\r\n~~~\r\nNotifynder::deleteCategory(1);\r\n~~~\r\n\r\nAs first parameter you pass the id of the category you want to delete or again you can use the method `category` and it will think about to get the id for you just passing the name\r\n\r\n~~~\r\ntry\r\n{\r\n    Notifynder::category('londonNews')->deleteCategory();\r\n}\r\ncatch(Fenos\\Notifynder\\Exceptions\\NotificationCategoryNotFoundException $e)\r\n{\r\n\r\n    // category not found\r\n\r\n}\r\n~~~\r\n\r\n### Advanced Categories ###\r\n\r\n**In the release 1.4.0 the migration file has changed adding one more column called \"extra\" to the table notifications**\r\n\r\nThe advanced categories permit to have a really nice body text inseting \"special values\". this \"special values\" will be dynamic and parsed from notifynder.\r\nLet's see an example for understand better the logic:\r\n\r\nWe want to have a notificaton that says: `User X has invited you on the event NOTIFYNDER`/\r\n\r\nBut we know that user `X` and `NOTIFYNDER` will change for different users and events.\r\nFor achieve this result when you create the category see the code example:\r\n\r\n~~~\r\nNotifynder:addCategory('inviteEvent','User {user.name} has invited you on the event {extra}'); // that's it!\r\n~~~\r\n\r\nThe values between `{}` are the specials values but how you saw on the example I used the first one with the `dot` annotation and the second one without it why?\r\n\r\nThis two values are really different, because the first one get the value from the current relation of the user table so you can use all the felds about the user that sent the notification, example: `user.surname`.\r\nInstead the `{extra}` value a static special value and it will be replaced from the value `extra` in your table notifications. \r\nSo for now you are limited to have as many as you want for relation values and 1 **extra** value on your body text. on the future release this limit will be deleted.\r\n\r\n### Send Notification / s ###\r\n\r\nNotifynder permit to send a single notification or multiple notifications at once. Let's see how:\r\n\r\n#### Send Single Notification ####\r\n\r\n~~~\r\n\r\n$notification_information = array(\r\n\r\n    'from_id'     => 1, // ID user that send the notification\r\n    'to_id'       => 2, // ID user that receive the notification\r\n    'category_id' => 1, // category notification ID\r\n    'url'         => 'www.urlofnotification.com', // Url of your notification\r\n);\r\n\r\nNotifynder::sendOne($notification_information); // it just send!\r\n\r\n~~~\r\n\r\nBut remember you can always use the method `category()` and don't hard code the category id!\r\n\r\n~~~\r\ntry\r\n{\r\n\r\n    $notification_information = array(\r\n    \r\n        'from_id'     => 1, // ID user that send the notification\r\n        'to_id'       => 2, // ID user that receive the notification\r\n        'url'         => 'www.urlofnotification.com', // Url of your notification\r\n    );\r\n    \r\n    Notifynder::category('londonNews')->sendOne($notification_information); // it just send!\r\n}\r\ncatch(Fenos\\Notifynder\\Exceptions\\NotificationCategoryNotFoundException $e)\r\n{\r\n\r\n    // category not found\r\n\r\n}\r\n~~~\r\n\r\n\r\n#### Send multiple notifications ####\r\n\r\nNow it's time to send multiple notification at once! The only thing you need to keep attention is that `created_at` and `updated_at` are not updated automatically so just put it on your array :)\r\n\r\n~~~\r\n$notification_information = array(\r\n    \r\n    array (\r\n        'from_id'     => 1, // ID user that send the notification\r\n        'to_id'       => 2, // ID user that receive the notification\r\n        'category_id' => 1, // ID category\r\n        'url'         => 'www.urlofnotification.com', // Url of your notification\r\n        'extra'       => 'extra value' // extra value that will be replace if present {extra} in the category body\r\n        'created_at'  => Carbon::now(),\r\n        'updated_at'  => Carbon::now()\r\n    ),\r\n    \r\n    array (\r\n        'from_id'     => 1, // ID user that send the notification\r\n        'to_id'       => 4, // ID user that receive the notification\r\n        'category_id' => 2, // ID category\r\n        'url'         => 'www.urlofnotification.com', // Url of your notification\r\n        'extra'       => 'extra value' // extra value that will be replace if present {extra} in the category body\r\n        'created_at'  => Carbon::now(),\r\n        'updated_at'  => Carbon::now()\r\n    )\r\n);\r\n\r\n\r\nNotifynder::sendMultiple($notification_information);\r\n~~~\r\n\r\nIn this method the `category()` method will not work on chaining, but instead let's see how can you use it here!\r\n\r\n~~~\r\n$notification_information = array(\r\n    \r\n    array => (\r\n        'from_id'     => 1, // ID user that send the notification\r\n        'to_id'       => 2, // ID user that receive the notification\r\n        'category_id' => Notifynder::category('londonNews')->id(), // Will give you the notification ID\r\n        'url'         => 'www.urlofnotification.com', // Url of your notification\r\n        'extra'       => 'extra value' // extra value that will be replace if present {extra} in the category body\r\n        'created_at'  => Carbon::now(),\r\n        'updated_at'  => Carbon::now()\r\n    ),\r\n    \r\n    array => (\r\n        'from_id'     => 1, // ID user that send the notification\r\n        'to_id'       => 4, // ID user that receive the notification\r\n        'category_id' => Notifynder::category('londonNews')->id(), // Will give you the notification ID\r\n        'url'         => 'www.urlofnotification.com', // Url of your notification\r\n        'extra'       => 'extra value' // extra value that will be replace if present {extra} in the category body\r\n        'created_at'  => Carbon::now(),\r\n        'updated_at'  => Carbon::now()\r\n    )\r\n);\r\n\r\n\r\nNotifynder::sendMultiple($notification_information);\r\n~~~\r\n\r\n### Read Notification/s ###\r\n\r\nNow is time to make it read when the user read the notification/s! Let's see how!\r\n\r\n#### Read One ####\r\n\r\nWith this method will make read a single notification giving the id of it.\r\nif you give an ID that doesn't exist prepare yourself to catch an exception\r\n\r\n~~~\r\ntry\r\n{\r\n\r\n    Notifynder::readOne($notification_id); // That's It\r\n}\r\ncatch(Fenos\\Notifynder\\Exceptions\\NotificationNotFoundException $e)\r\n{\r\n\r\n    // Notification not found\r\n\r\n}\r\n~~~\r\n\r\n\r\n#### Read All ####\r\n\r\nWith this method will make read all the notifications that hasn't been read but this time you will pass the id of the user. The equivalent to the id of the `to_id` filed on the you table.\r\n\r\n~~~\r\nNotifynder::readAll($to_id); // this will make read all the notifications not read of this user user\r\n~~~\r\n\r\n#### Read Limit ####\r\nWell when is time to have thousand of notifications to read you will need to set up a Queues or something and this method will be really useful to you. In few words this method will let you make read only the number of notifications you set! If you want to update the last 10 notifications or the first one Let's see how:\r\n\r\n~~~\r\n$to_id = 1;\r\n\r\nNotifynder::readLimit($to_id,10,'ASC'); // This method will update the first 10 notifications of the user with ID 1\r\n~~~\r\n\r\n**Parameters**\r\n- first : To id (Id of the user)\r\n- second : numbers of notifications you want to make read,\r\n- third : direction of the order - 'ASC' / 'DESC'\r\n\r\n### Retrive notifications ###\r\n\r\nNow we did everything but we need somehow to get this notifications! Let's see how:\r\n\r\n#### Get Not Read ####\r\n\r\nThis method will get all notifications not read giving the user id\r\n\r\n~~~\r\nNotifynder::getNotRead($user_id); // get all not read\r\n~~~\r\n\r\nYou can also limit the results passing the value as second parameter:\r\n\r\n~~~\r\nNotifynder::getNotRead($user_id,10); // get 10 notifications not read\r\n~~~\r\n\r\nDo you need to paginate the notifications? give a true value as third parameter it will do the trick!\r\n\r\n~~~\r\nNotifynder::getNotRead($user_id,10,true); // get notifications not read paginating 10 results per page\r\n~~~\r\n\r\n#### Get All ####\r\n\r\nThis method will get all notifications **Even the read**, about the current user, of course the notifications not read will be at first position.\r\n\r\n~~~\r\nNotifynder:getAll($user_id); // get all notifications\r\n~~~\r\n\r\nLimiting\r\n\r\n~~~\r\nNotifynder::getAll($user_id,10) // get all notifications limiting at 10 the result\r\n~~~\r\n\r\nPaginate the result\r\n\r\n~~~\r\nNotifynder::getAll($user_id,10,true);\r\n~~~\r\n\r\n\r\n### Delete Notification ###\r\n\r\nAs before we have 3 methods availables to manage the action to delete the notifications let's see how use it.\r\n\r\n#### Delete single ####\r\n\r\nFor delete a single notification we pass the id of the current notification to delete simply like so:\r\n\r\n~~~\r\nNotifynder::delete( 2 ); // it will detele the notification with ID 2\r\n~~~\r\n\r\n\r\n#### Delete All ####\r\n\r\nThis method will delete all notifications about the current user passed as first parameter.\r\n\r\n~~~\r\nNotifynder::deleteAll( 1 ); // it will delete all notification of the user with ID 1\r\n~~~\r\n\r\n#### Delete Limit ####\r\n\r\nThis method will be very useful as the `Notifynder::readLimit()` because it give you possibility to limit the notifications to delete very useful associated to a cron job.\r\n\r\n~~~\r\nNotifynder::deleteLimit( 1, 10, 'ASC' )\r\n~~~\r\n\r\nas first parameter you will pass the id of the user, as second parameter you will pass the number of notifications to delete, as third parameter you will pass the order that will start to count the number of notifications `\"ASC\" - \"DESC\"`\r\n\r\n### Method Category() ###\r\n\r\nThe method category before used on the documentation give you the possibility to don't hard code the id of the category but instead write the name of it.\r\nBut how it work? It does a query to the database for get the correct ID. But hey stay easy it is **lazy loading** like so even if you use that method for 100 notifications of the same type it will do only 1 quick query.\r\n\r\n**Also remember: If you digit a name that doesn't exist on the database it will throw an exception but you can always catch it.**\r\n\r\n~~~\r\n\r\ntry\r\n{\r\n\r\nNotifynder::category('notFound')->id(); // or whenever method you use\r\n\r\n}\r\ncatch(Fenos\\Notifynder\\Exceptions\\NotificationCategoryNotFoundException $e)\r\n{\r\n\r\n// category not found\r\n\r\n}\r\n~~~\r\n\r\n### Translations ###\r\n\r\nWhen you have a good system of notifications and you want extends that notifications to multiple languages, Notifynder use a easy approch for make it work.\r\n\r\nYou have to publish the configurations files, doing:\r\n\r\n~~~\r\nphp artisan config:publish fenos/notifynder\r\n~~~\r\n\r\nUnder the directory `app/config/packages/fenos/notifynder` you will find a file called `translations.php` that file is the right place to put your translations.\r\n\r\nYou will see that file with an array with same keys of the languages availables, feel free to add how many languages you want.\r\n\r\nInside that array you will put another array with they **key as the name of your category** and **the value with the translation of it**.\r\n\r\n~~~\r\n\r\nreturn array(\r\n        \r\n        'it' => array( // italian language\r\n\r\n            // name category  \r\n            'comment' => 'ho postato un commento' // translation\r\n\r\n        ),\r\n\r\n        'fr' => array ( // french language\r\n\r\n            'comment' => 'J'ai posté un commentaire'\r\n        )\r\n);\r\n\r\n~~~\r\n\r\nAnd now for retrieve the notifications translated, you use as normal the methods `getAll` - `getNotRead` but you easilly chain the method translate with the language as first parameter:\r\n\r\n~~~\r\n\r\nNotifynder::getAll( 2 )->translate('it');\r\n\r\n~~~\r\n\r\nIt will return to you the body translated!\r\n\r\n\r\n### Notifications Handler ###\r\n\r\nWhat's this new future? Well notifynder handler is a simple class that permit you to have good separation of your logic for send notifications.\r\nSometimes you wish to send a notification when something happen. Sometimes \"how is happened to me\" I found myself to write 100 rows and i didn't know where put that, just for determinate wich category send\r\nwhy, and when. \r\n\r\nThen this class will support us for separate our logic, let's see how it work:\r\n\r\n\r\nFirst you have to create a file called `notifications.php` on your `app` folder or whenever you feel right to create it. **It must be autoloaded** so let's adding it on your composer json:\r\n\r\nThis will not be a class so you will use `files` under autoload section.\r\n~~~\r\n\"files\": [\r\n    \"app/notifications.php\"\r\n]\r\n~~~\r\n\r\nThis file will be more or less similar to your route file where you'll listen this kind the event to be triggered. \r\nFor determinate a listener of a behavior that a notification should have let's see the code of example:\r\n\r\n~~~\r\nNotifynder::listen(['key' => 'EventInvite', 'handler' => 'YourClass@YourMethod']);\r\n~~~\r\n\r\nLet's describe what's going on here, we are passing an array with 2 **main keys** `key` and `handler`.\r\n\r\n- The `key` will give you the possibility to trigger this event whenever has been called.\r\n- The `handler` will fill with your Class and the method that will contain your logic for the notification. It is separate with `@`\r\n\r\nWhen you set up this listener I'm going to create that class for make more clear the situation:\r\n\r\n~~~\r\n\r\nclass YourClass {\r\n\r\n    // you can also use dependency Injection on your constructor the class \r\n    //will be resolved with App::make behind the scences\r\n    \r\n    /**\r\n    * Logic for send a notification to users\r\n    * Excluding the session id user\r\n    *\r\n    * @param $array_user_id (Array)\r\n    * @return Array\r\n    */\r\n    public function YourMethod($array_user_id) // i pass a array of user id that will receive the notification\r\n    {                                          // you can pass any parameters you want\r\n        if ( count($array_user_id) > 0 )\r\n        {\r\n\r\n            // delete the id of the user logged that send the notification\r\n            if(($key = array_search(Auth::user()->id, $array_user_id)) !== false) {\r\n\r\n                unset($array_user_id[$key]);\r\n            }\r\n\r\n            // i set up the array to send for all the remain users\r\n            foreach ($array_user_id as $key => $value)\r\n            {\r\n                $notification_information[] = array(\r\n\r\n                    'from_id'     => Auth::user()->id,      // ID user that send the notification\r\n                    'to_id'       => $array_user_id[$key],  // ID user that receive the notification\r\n                    'category_id' => 1,                     // category id\r\n                    'url'         => 'www.urlofnotification.com', // Url of your notification\r\n                );\r\n            }\r\n\r\n            // return the array of the users\r\n            return $notification_information;\r\n\r\n        }\r\n\r\n        // return false if there is no user to send\r\n        return false;\r\n\r\n    }\r\n\r\n}\r\n~~~\r\n\r\nWell this is how you set up your logic for the notifications returning the array of the users that you want that the current notification will be sent.\r\n**Remember to return false in case no notifications will be sent** You will understand why in a bit.\r\n\r\nNow we had made listening our notification and set up our logic for make it send, now is time to **trigger** this notification.\r\n\r\nInstead to use directly the method `Notifynder::sendMultiple()` it will be used with a closure and it permit to invoke that method sending the notification as well.\r\nLet's see this:\r\n\r\n~~~\r\nNotifynder::fire('EventInvite',['values' => $myValues, 'use' => function($notifynder,$yourMethodCallBack){\r\n    \r\n    return $notifynder->sendMultiple($yourMethodCallBack); // cool isn't?\r\n\r\n}]);\r\n~~~\r\n\r\nLet's describe it:\r\n\r\n - First Parameter is the `key` that had set on the listener\r\n - The second parameter is an array passing `values` if you have any extra values to pass a that function, if you haven't any you can not use it.\r\n   As `use` value you pass a closure, in this closure you'll find as first parameter the object of notifynder, and the second the parameter is that value that you\r\n   returned from your function\r\n\r\nIf your method return false, the code Inside the closure will not be triggered and the clouse will return false as well.\r\n\r\nNow for complete this example let's see this in action:\r\n\r\n~~~\r\n\r\nclass MyController extends BaseController\r\n{\r\n\r\n    public function inviteToEvent()\r\n    {\r\n        $users_selected = Input::get('users_selected'); // Array of users\r\n\r\n        Notifynder::fire('EventInvite',['values' => $users_selected, 'use' => function($notifynder, $users){\r\n\r\n            return $notifynder->sendMultiple($users); // it send to all your users!\r\n\r\n        }]);\r\n    }\r\n}\r\n\r\n~~~\r\n\r\nI hope you can see the benefits of that. Enjoy it.\r\n\r\n### Extend the model class ###\r\n\r\nWell, I like have packages more extendible possible, so I give you the possibility to extend the model for make your own staff become real.\r\n\r\nEven here you will have to take a look the configuration file. Under the key `notification_model` you have to change the current model with the **namespace** / **name** of your model and extend it with the previous one.\r\n\r\n~~~\r\n\r\nuse Fenos\\Notifynder\\Models\\Notification;\r\n\r\nclass NewNotificationModel extends Notification\r\n{\r\n\r\n}\r\n\r\n~~~\r\n\r\n#### Tests ####\r\n\r\nFor run the tests make sure to have phpUnit and Mockery installed\r\n\r\n#### Package ####\r\n\r\n© Copyright Fabrizio Fenoglio\r\n\r\nReleased package under MIT Licence.\r\n","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}